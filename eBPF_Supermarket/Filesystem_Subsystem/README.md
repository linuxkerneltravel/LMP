## 基于eBPF的Linux系统性能监测工具-文件系统
### 1、题目描述：
Linux系统性能监测对于监测系统运行状态、分析系统运行效率、定位运行故障以及优化系统设计等方面都具有重要的意义。本题目基于eBPF机制对Linux系统中文件系统的性能进行监测。完成的内容包括：
（1）分析Linux中文件系统的基本原理，提出性能监测参数，例如包括VFS方法触发频率、dcache缓存命中率等关键参数。
（2）利用eBPF工具提取性能监测参数并进行分析展示。
（3）在对系统监测工具开销评价的基础上，提出相应的工具优化策略。
（4）可能的情况下，尝试将该监测工具部署在华为的鸿蒙系统上并进行测试。

#### 项目产出
- 完整的项目代码一份
- 详细的中文文档，包括系统设计、安装部署及系统测试等。如果能部署在鸿蒙系统上，属于加分项。

#### 项目技术要求
- 了解eBPF技术
- 了解Linux内核中文件系统的基本原理
- 有一定的C编程能力


### 2、初步分析
**要点：**
1）Linux中文件系统的基本原理
2）提出**性能监测参数**并展示
3）对系统监测工具**开销评价**的基础上，提出相应的工具**优化策略**
4）部署在华为的鸿蒙系统上

#### 文件系统基本原理
磁盘->文件->文件系统

- **物理结构：**
扇区->块->磁盘
磁盘的最小单位是扇区 sector，扇区的大小通常为512字节；
块为若干个扇区组成；
对于硬件设备来说，扇区是基本的数据传输单元；而对于VFS（虚拟文件系统），块（block）是基本的数据传输单元。例如，当内核访问文件的数据时，它首先从磁盘上读取一个块，这个块有文件的inode，该块对应于磁盘上一个或多个扇区。

- **逻辑结构：**
fs_type->sb->dentry->inode->files

- **VFS基本原理**
VFS之所以能够衔接各种各样的文件系统，是因为它抽象了一个通用的文件系统模型，定义了通用文件系统都支持的、概念上的接口。新的文件系统只要支持并实现这些接口，并注册到Linux内核中，即可安装和使用。
Linux为了实现这种VFS系统，采用面向对象的设计思路，主要抽象了四种对象类型：
- VFS支持的的文件系统可以分成主要三种类型:
基于磁盘（disk-based）的文件系统：如EXT4
网络文件系统：如NFS
特殊文件系统：不管理磁盘空间，如proc

- VFS有四个主要对象类型：
    - spuer_block 
表示特定加载的文件系统，用来存储文件系统的信息,操作方法super_operations
    - inode 
索引节点对象，表示特定的文件，操作方法inode_operations
    - dentry 
表示一个目录项，路径的一个组成部分，操作方法dentry_operations
    - file 
表示进程打开的一个文件，操作方法file_operations

    此外VFS还使用了另外一些数据结构来管理文件系统：
    - file_system_type
描述每种文件系统的功能和行为
    - vfsmount
当文件系统被实际安装时，将有一个vfsmount结构体在安装点被创建。该结构体用来代表文件系统的实例，即代表一个安装点。

- 和进程相关的结构**fs_struct、file_struct**
在一个进程打开的时候会产生task_struct结构，其中有两个字段fs和file：
fs字段指向fs_struct结构体，表示这个进程的工作目录，包括根目录和当前工作目录等信息（dentry、inode对象）;
file字段指向files_struct结构体，这个结构体是用来记录该进程打开的所有文件的信息（file对象）。

### 3、实验环境
##### 操作系统
Ubuntu-18.04.1
##### 内核
5.4.0-104-generic
##### 前端
BCC
##### 语言
Python、C
#### 目录安排
|目录|作用|
|---|---|
./|监控工具fs.py
tools|监控脚本
docs|参考文档，学习文档，学习笔记