## XDP与其它Kernel Bypass方案的比较

随着互联网流量越来愈大, 网卡性能越来越强，Linux 内核协议栈在 10/100Mbps 网卡的慢速时代是没有任何问题的，那个时候应用程序大部分时间在等网卡送上来数据。现在到了 10Gbps/40Gbps 网卡的时代，数据被很快地收入，协议栈复杂处理逻辑，效率捉襟见肘，大量的报文堵在内核里。sk_buff 的分配与释放、内存拷贝的开销、软中断路径过长等等问题都出现了。于是出现了许多Kernel Bypass 的方案，如 DPDK、RDMA 等来优化网络处理。

### XDP与DPDK的比较

DPDK 的核心思想是将协议栈上移到用户态，利用 UIO 技术直接将设备数据映射拷贝到用户态，采用了轮询或者轮询混杂中断的模式来进行收包和发包，其降低了中断次数以及内存拷贝次数，并且绕过了内核网络协议栈，使得用户获得了协议栈的控制权。相较于 DPDK，XDP 维护了内核的边界，无需定义新的安全网络模型、无需分配大页内存、无需专用的 CPU，更好与现有系统集成。并且在容器环境背景下，内核担负着资源抽象和隔离的重任，内核Bypass 的方式会导致系统越来越复杂，并且可能导致其它安全问题。但是在一些场景下，XDP 的性能仍与 DPDK 有差距。

### XDP与RDMA的对比

RDMA 与 DPDK 相反，是把协议栈下沉到网络设备处理。RDMA 的思想来源于 DMA，都是为了减轻 CPU 负担直接操作内存的。RDMA 可以绕过内核网络协议栈，直接读写用户内存，实现零拷贝。相较于 RDMA，XDP 的优点同样在于兼容性，无需专门的硬件支持。并且可以复用现有的安全机制以及配置、部署和管理工具。但缺点也仍是性能上不如 RDMA，属于一种折中的方案。

### 结论

相比于 DPDK、RDMA 这种完全内核 Bypass 方式，XDP 采取了相对来说比较保守的方式来优化网络性能，它是内核的一个改进，可以与传统的网络协议栈并存，而不是取代。并且，XDP 可以保证内核的安全边界，仍然将硬件的控制权留在内核范围内。最重要的一点是，XDP 的兼容性很好,无需对网络配置或管理工具做修改，也无需特殊的硬件支持。但是其性能上与 Bypass 的方式仍有差距。